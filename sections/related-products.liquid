{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

<div
  class="product-recommendations"
  data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit=4&intent=related"
>
  <noscript>
    <p>{{ 'Please enable JavaScript to view product recommendations.' | t }}</p>
  </noscript>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const productRecommendationsSection = document.querySelector('.product-recommendations');
    if (!productRecommendationsSection) return;

    const handleIntersection = (entries, observer) => {
      if (!entries[0].isIntersecting) return;

      observer.unobserve(productRecommendationsSection);

      const url = productRecommendationsSection.dataset.url;

      fetch(url)
        .then(response => response.text())
        .then(html => {
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = html;

          const recommendations = tempDiv.querySelector('.product-recommendations');
          if (recommendations && recommendations.innerHTML.trim()) {
            productRecommendationsSection.innerHTML = recommendations.innerHTML;
          }
        })
        .catch(error => console.error('Error fetching recommendations:', error));
    };

    const observer = new IntersectionObserver(handleIntersection, { rootMargin: '0px 0px 200px 0px' });
    observer.observe(productRecommendationsSection);
  });
</script>

{% schema %}
{
  "name": "Product recommendations",
  "settings": []
}
{% endschema %}