<script>
    document.addEventListener('DOMContentLoaded', () => {
        try {
          // Haal het product-object op
          const productData = JSON.parse(document.getElementById('product-data').textContent);
          console.log("Product Data:", productData);
      
          // Selecteer belangrijke elementen
          const colorSwatchContainer = document.querySelector('.color-swatches');
          const sizeSwatchContainer = document.querySelector('.size-swatches');
          const mediaGallery = document.querySelector('.media-gallery');
          const variantInput = document.getElementById('selected-variant-id');
      
          // Groepeer varianten op kleur en maat
          const colorVariants = productData.variants.reduce((acc, variant) => {
            if (!acc[variant.option1]) {
              acc[variant.option1] = [];
            }
            acc[variant.option1].push(variant);
            return acc;
          }, {});
      
          console.log("Color Variants:", colorVariants);
      
          let activeColor = null;
          let activeSize = null;
      
          // Dynamisch kleur-swatches genereren
          Object.keys(colorVariants).forEach(color => {
            console.log(`Generating color swatch for: ${color}`);
            
            const swatch = document.createElement('button');
            swatch.classList.add('color-swatch');
            swatch.dataset.color = color;
            swatch.textContent = color;
            swatch.style.backgroundColor = color.toLowerCase();
      
            swatch.addEventListener('click', () => {
              console.log(`Color swatch clicked: ${color}`);
              activeColor = color; // Update actieve kleur
              updateActiveSwatch(colorSwatchContainer, swatch); // Markeer actief
              updateGallery(color);
              updateSizeSwatches(colorVariants[color], activeSize); // Houd actieve maat als die bestaat
              updateFeaturedImage(color, activeSize);
            });
      
            colorSwatchContainer.appendChild(swatch);
          });
      
          // Dynamisch maat-swatches genereren
          const updateSizeSwatches = (variants, keepActiveSize = null) => {
            console.log(`Updating size swatches for variants:`, variants);
      
            sizeSwatchContainer.innerHTML = ''; // Reset de maat-swatches
      
            const uniqueSizes = [...new Set(variants.map(variant => variant.option2))];
      
            uniqueSizes.forEach(size => {
              console.log(`Generating size swatch for: ${size}`);
              
              const sizeSwatch = document.createElement('button');
              sizeSwatch.classList.add('size-swatch');
              sizeSwatch.dataset.size = size;
              sizeSwatch.textContent = size;
      
              sizeSwatch.addEventListener('click', () => {
                console.log(`Size swatch clicked: ${size}`);
                activeSize = size; // Update actieve maat
                updateActiveSwatch(sizeSwatchContainer, sizeSwatch); // Markeer actief
                const selectedVariant = variants.find(variant => variant.option2 === size);
                if (selectedVariant) {
                  updateBuyButton(selectedVariant.id);
                  updateURLWithVariant(selectedVariant.id);
                  updateFeaturedImage(activeColor, size); // Update de featured image
                }
              });
      
              sizeSwatchContainer.appendChild(sizeSwatch);
      
              // Houd actieve maat als die bestaat
              if (keepActiveSize && size === keepActiveSize) {
                updateActiveSwatch(sizeSwatchContainer, sizeSwatch);
              }
            });
      
            // Selecteer standaard de eerste maat als geen actieve maat
            if (!keepActiveSize && uniqueSizes.length > 0) {
              const firstSize = uniqueSizes[0];
              console.log(`Selecting default size: ${firstSize}`);
              const defaultVariant = variants.find(variant => variant.option2 === firstSize);
              if (defaultVariant) {
                updateBuyButton(defaultVariant.id);
                updateURLWithVariant(defaultVariant.id);
                updateActiveSwatch(sizeSwatchContainer, sizeSwatchContainer.querySelector(`[data-size="${firstSize}"]`));
              }
            }
          };
      
          // Functie om de gallery te updaten
          const updateGallery = (color) => {
            console.log(`Updating gallery for color: ${color}`);
            mediaGallery.innerHTML = ''; // Clear de gallery
      
            // Voeg de afbeeldingen toe
            const featuredImage = productData.featured_image;
            const additionalImages = productData.images.slice(0, 2);
            const images = [featuredImage, ...additionalImages];
      
            images.forEach(image => {
              console.log("Adding image to gallery:", image);
              const imgElement = document.createElement('img');
              imgElement.src = image;
              imgElement.alt = `Image for color ${color}`;
              mediaGallery.appendChild(imgElement);
            });
          };
      
          // Functie om de featured image bij te werken
          const updateFeaturedImage = (color, size) => {
            const selectedVariant = productData.variants.find(variant => variant.option1 === color && variant.option2 === size);
            if (selectedVariant) {
              console.log("Updating featured image with variant image:", selectedVariant.featured_image);
              mediaGallery.innerHTML = ''; // Clear de gallery
              const imgElement = document.createElement('img');
              imgElement.src = selectedVariant.featured_image || productData.featured_image;
              imgElement.alt = `Featured image for ${color} - ${size}`;
              mediaGallery.appendChild(imgElement);
            }
          };
      
          // Functie om de actieve swatch te markeren
          const updateActiveSwatch = (container, activeSwatch) => {
            container.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
            activeSwatch.classList.add('active');
          };
      
          // Functie om de variant-ID in het formulier bij te werken
          const updateBuyButton = (variantId) => {
            console.log(`Updating buy button with variant ID: ${variantId}`);
            variantInput.value = variantId;
          };
      
          // Functie om de URL bij te werken
          const updateURLWithVariant = (variantId) => {
            const url = new URL(window.location.href);
            url.searchParams.set('variant', variantId);
            window.history.replaceState({}, '', url.toString());
            console.log(`URL updated with variant ID: ${variantId}`);
          };
      
          // Validatie bij paginalading
          const validateVariantFromURL = () => {
            const url = new URL(window.location.href);
            const variantId = url.searchParams.get('variant');
            console.log(`Validating variant ID from URL: ${variantId}`);
      
            if (variantId) {
              const selectedVariant = productData.variants.find(variant => variant.id.toString() === variantId);
              if (selectedVariant) {
                console.log("Valid variant ID found:", selectedVariant);
                activeColor = selectedVariant.option1;
                activeSize = selectedVariant.option2;
                updateActiveSwatch(colorSwatchContainer, colorSwatchContainer.querySelector(`[data-color="${activeColor}"]`));
                updateActiveSwatch(sizeSwatchContainer, sizeSwatchContainer.querySelector(`[data-size="${activeSize}"]`));
                updateFeaturedImage(activeColor, activeSize);
                updateGallery(activeColor);
              } else {
                console.warn("Invalid variant ID. Removing from URL.");
                url.searchParams.delete('variant');
                window.history.replaceState({}, '', url.toString());
              }
            } else {
              console.log("No variant ID in URL. Setting default.");
              activeColor = Object.keys(colorVariants)[0];
              updateGallery(activeColor);
              updateSizeSwatches(colorVariants[activeColor]);
            }
          };
      
          // Initialisatie
          validateVariantFromURL();
        } catch (error) {
          console.error("Error initializing product media gallery:", error);
        }
      });                                          
</script>

<style>
    .product-title {
        font-size: 24px;
        margin-bottom: 10px;
      }
      
      .color-swatches {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      
      .color-swatch {
        width: 40px;
        height: 40px;
        border: 2px solid #ccc;
        border-radius: 50%;
        cursor: pointer;
      }
      
      .color-swatch:hover {
        border-color: #000;
      }
      
      .media-gallery img {
        max-width: 100%;
        margin-bottom: 10px;
      }
      
      .buy-button {
        padding: 10px 20px;
        background-color: #000;
        color: #fff;
        border: none;
        cursor: pointer;
        font-size: 16px;
      }
      
      .buy-button:hover {
        background-color: #333;
      }

      .color-swatch.active, .size-swatch.active {
        border: 2px solid #000;
        background-color: #eee;
      }
      
</style>

  <div class="row">
    <!-- Dynamische media gallery -->
    <div class="media-gallery col-6">
            <!-- Afbeeldingen worden dynamisch toegevoegd -->
    </div>

    <div class="product-section col-6">
    <!-- Dynamische titel -->
    <h1 class="product-title">{{ product.title }}</h1>
  
    <!-- Dynamische kleur selectie -->
    <div class="color-swatches">
      <!-- Kleur-swatches worden dynamisch toegevoegd -->
    </div>
  
    <!-- Dynamische maat selectie -->
    <div class="size-swatches">
      <!-- Maat-swatches worden dynamisch toegevoegd -->
    </div>
  
    <!-- Dynamische media gallery -->
    <div class="media-gallery">
      <!-- Afbeeldingen worden dynamisch toegevoegd -->
    </div>
  
    <!-- Aankoopknop -->
    <form method="post" action="/cart/add">
      <input type="hidden" name="id" id="selected-variant-id" />
      <button type="submit" class="buy-button">{{ section.settings.buy_button_text }}</button>
    </form>
  </div>
</div> 

  <!-- JSON Data -->
  <script type="application/json" id="product-data">
    {{ product | json }}
  </script>
  
  
  <!-- Schema voor de Shopify Theme Editor -->
{% schema %}
{
  "name": "Product Media Gallery",
  "settings": [
    {
      "type": "text",
      "id": "buy_button_text",
      "label": "Buy Button Text",
      "default": "Add to Cart"
    }
  ],
  "presets": [
    {
      "name": "Product Media Gallery",
      "category": "Product"
    }
  ]
}
{% endschema %}