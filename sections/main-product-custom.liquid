<script>
    document.addEventListener('DOMContentLoaded', () => {
        try {
          const productData = JSON.parse(document.getElementById('product-data').textContent);
          console.log("Product Data:", productData);
      
          const colorSwatchContainer = document.querySelector('.color-swatches');
          const sizeSwatchContainer = document.querySelector('.size-swatches');
          const mediaGallery = document.querySelector('.media-gallery');
          const variantInput = document.getElementById('selected-variant-id');
      
          let activeColor = null;
          let activeSize = null;
      
          const updateGallery = (variantId) => {
            console.log(`Updating gallery for variant ID: ${variantId}`);
            mediaGallery.innerHTML = ''; // Clear de gallery
            const secondaryGallery = document.querySelector('.secondary-gallery');
            secondaryGallery.innerHTML = ''; // Clear de secondary gallery
          
            // Vind de geselecteerde variant
            const selectedVariant = productData.variants.find(variant => variant.id === variantId);
            console.log("Selected Variant:", selectedVariant);
          
            if (selectedVariant && selectedVariant.featured_image) {
              console.log("Using variant-specific featured image:", selectedVariant.featured_image.src);
              const imgElement = document.createElement('img');
              imgElement.src = selectedVariant.featured_image.src;
              imgElement.alt = `Featured image for variant ID: ${variantId}`;
              mediaGallery.appendChild(imgElement);
            } else {
              console.warn("No specific variant featured image found. Using default images.");
              const fallbackImages = [productData.featured_image, ...productData.images.slice(0, 2)];
              fallbackImages.forEach(image => {
                const imgElement = document.createElement('img');
                imgElement.src = image;
                imgElement.alt = "Fallback image";
                mediaGallery.appendChild(imgElement);
              });
            }
          
            // Voeg secundaire afbeeldingen toe
            if (selectedVariant) {
              const color = selectedVariant.option1.toLowerCase(); // Neem de kleur uit de variant
              const secondaryImages = productData.media.filter(media =>
                media.alt && media.alt.toLowerCase().includes(color)
              );
          
              console.log(`Secondary images for color ${color}:`, secondaryImages);
          
              secondaryImages.forEach(image => {
                const colDiv = document.createElement('div');
                colDiv.classList.add('col-6'); // Voeg col-6 styling toe
          
                const imgElement = document.createElement('img');
                imgElement.src = image.src;
                imgElement.alt = image.alt || "Secondary image";
          
                colDiv.appendChild(imgElement);
                secondaryGallery.appendChild(colDiv);
              });
            }
          };          
      
          // Update buy button with variant ID
          const updateBuyButton = (variantId) => {
            console.log(`Updating buy button with variant ID: ${variantId}`);
            variantInput.value = variantId;
          };
      
          // Update active swatch
          const updateActiveSwatch = (container, activeSwatch) => {
            container.querySelectorAll('.active').forEach(el => el.classList.remove('active'));
            activeSwatch.classList.add('active');
          };
      
          // Handle selection of color and size
          const handleSelectionChange = (color, size) => {
            console.log(`Color: ${color}, Size: ${size}`);
            const selectedVariant = productData.variants.find(
              variant => variant.option1 === color && variant.option2 === size
            );
      
            if (selectedVariant) {
              console.log("Selected Variant ID:", selectedVariant.id);
              updateGallery(selectedVariant.id);
              updateBuyButton(selectedVariant.id);
            } else {
              console.warn("No matching variant found. Loading default images.");
              updateGallery(null);
            }
          };
      
            // Verzamel unieke kleuren uit de varianten
            const uniqueColors = [...new Set(productData.variants.map(variant => variant.option1).filter(Boolean))];

            console.log("Available Colors in Variants:", productData.variants.map(variant => variant.option1));
            console.log("Unique Colors for Swatches:", uniqueColors);

            // Genereer swatches voor elke unieke kleur
            uniqueColors.forEach(color => {
            console.log(`Generating color swatch for: ${color}`);
            
            const swatch = document.createElement('button');
            swatch.classList.add('color-swatch');
            swatch.dataset.color = color;
            swatch.textContent = color;
            swatch.style.backgroundColor = color.toLowerCase();

            swatch.addEventListener('click', () => {
                activeColor = color;
                updateActiveSwatch(colorSwatchContainer, swatch);
                handleSelectionChange(activeColor, activeSize);
            });

            colorSwatchContainer.appendChild(swatch);
            });
 
          // Create size swatches
          const uniqueSizes = [...new Set(productData.variants.map(variant => variant.option2))];
          uniqueSizes.forEach(size => {
            const swatch = document.createElement('button');
            swatch.classList.add('size-swatch');
            swatch.dataset.size = size;
            swatch.textContent = size;
      
            swatch.addEventListener('click', () => {
              activeSize = size;
              updateActiveSwatch(sizeSwatchContainer, swatch);
              handleSelectionChange(activeColor, activeSize);
            });
      
            sizeSwatchContainer.appendChild(swatch);
          });
      
          // Load variant from URL
          const validateVariantFromURL = () => {
            const urlParams = new URL(window.location.href).searchParams;
            const variantId = parseInt(urlParams.get('variant'), 10);
            if (!isNaN(variantId)) {
              console.log("Loading variant ID from URL:", variantId);
              const selectedVariant = productData.variants.find(variant => variant.id === variantId);
              if (selectedVariant) {
                activeColor = selectedVariant.option1;
                activeSize = selectedVariant.option2;
      
                updateGallery(selectedVariant.id);
                updateBuyButton(selectedVariant.id);
      
                // Mark swatches as active
                const activeColorSwatch = colorSwatchContainer.querySelector(`[data-color="${activeColor}"]`);
                if (activeColorSwatch) updateActiveSwatch(colorSwatchContainer, activeColorSwatch);
      
                const activeSizeSwatch = sizeSwatchContainer.querySelector(`[data-size="${activeSize}"]`);
                if (activeSizeSwatch) updateActiveSwatch(sizeSwatchContainer, activeSizeSwatch);
              }
            } else {
              console.warn("No valid variant ID in URL. Using default values.");
              activeColor = productData.variants[0].option1;
              activeSize = productData.variants[0].option2;
      
              handleSelectionChange(activeColor, activeSize);
            }
          };
      
          // Initialize
          validateVariantFromURL();
        } catch (error) {
          console.error("Error initializing product media gallery:", error);
        }
      });                                                        
</script>

<style>
    .product-title {
        font-size: 24px;
        margin-bottom: 10px;
      }
      
      .color-swatches {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      
      .color-swatch {
        width: 40px;
        height: 40px;
        border: 2px solid #ccc;
        border-radius: 50%;
        cursor: pointer;
      }
      
      .color-swatch:hover {
        border-color: #000;
      }
      
      .media-gallery img {
        max-width: 100%;
        margin-bottom: 10px;
      }

      .product-gallery {
        margin-top: 20px;
      }
      
      .secondary-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }
      
      .secondary-gallery .col-6 img {
        max-width: 100%;
        height: auto; /* Houdt de aspectratio */
        max-height: 300px; /* Beperk de hoogte indien nodig */
        object-fit: cover; /* Zorg dat de afbeelding mooi geschaald wordt */
      }      
      
      .buy-button {
        padding: 10px 20px;
        background-color: #000;
        color: #fff;
        border: none;
        cursor: pointer;
        font-size: 16px;
      }
      
      .buy-button:hover {
        background-color: #333;
      }

      .color-swatch.active, .size-swatch.active {
        border: 2px solid #000;
        background-color: #eee;
      }
      
</style>

  <div class="row">
    <div class="product-gallery col-6">
        <div class="media-gallery col-12"></div>
        <div class="col-sm-6 col-md-4 secondary-gallery"></div>
    </div>

    <div class="product-section col-6">
    <!-- Dynamische titel -->
    <h1 class="product-title">{{ product.title }}</h1>
  
    <!-- Dynamische kleur selectie -->
    <div class="color-swatches">
      <!-- Kleur-swatches worden dynamisch toegevoegd -->
    </div>
  
    <!-- Dynamische maat selectie -->
    <div class="size-swatches">
      <!-- Maat-swatches worden dynamisch toegevoegd -->
    </div>
  
    <!-- Dynamische media gallery -->
    <div class="media-gallery">
      <!-- Afbeeldingen worden dynamisch toegevoegd -->
    </div>
  
    <!-- Aankoopknop -->
    <form method="post" action="/cart/add">
      <input type="hidden" name="id" id="selected-variant-id" />
      <button type="submit" class="buy-button">{{ section.settings.buy_button_text }}</button>
    </form>
  </div>
</div> 

  <!-- JSON Data -->
  <script type="application/json" id="product-data">
    {{ product | json }}
  </script>
  
  
  <!-- Schema voor de Shopify Theme Editor -->
{% schema %}
{
  "name": "Product Media Gallery",
  "settings": [
    {
      "type": "text",
      "id": "buy_button_text",
      "label": "Buy Button Text",
      "default": "Add to Cart"
    }
  ],
  "presets": [
    {
      "name": "Product Media Gallery",
      "category": "Product"
    }
  ]
}
{% endschema %}